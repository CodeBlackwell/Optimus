from compare_reports import Comparison
import sources

request_object = {"performance_summary":{"cols":[{"id":"dim_merchant-merchant_network","alias":"merchant_network","name":"Merchant Network"},{"id":"fact_impression-summary_impression_count","fact":True,"name":"Impressions","alias":"number_of_impressions","format":"int"},{"id":"fact_hit-summary_hit_count","fact":True,"name":"Clicks","alias":"number_of_clicks","format":"int"},{"id":"fact_order_avantlink-order_hash_key","fact":True,"name":"Orders","alias":"number_of_orders","format":"int","aggregate":[{"func":"count","distinct":True}]},{"id":"calculation","calc":"sales + adjustments","fact":True,"name":"Sales","vars":{"sales":{"id":"fact_order_avantlink-order_amount","aggregate":[{"func":"sum","distinct":True}]},"adjustments":{"id":"fact_order_adjustment-order_combined_adjustment_amount","aggregate":[{"func":"sum","distinct":True}]}},"alias":"net_sales","format":"money"},{"id":"calculation","calc":"sale+incentive+cpc+ppb+bonus+adjustment","fact":True,"name":"Affiliate Total Earnings","vars":{"cpc":{"id":"fact_cpc_earning-affiliate_earnings"},"ppb":{"id":"fact_ppb_earning-bid_amount"},"sale":{"id":"fact_order_commission-sale_commission_amount"},"bonus":{"id":"fact_order_bonus-bonus_commission_amount"},"incentive":{"id":"fact_order_commission-incentive_commission_amount"},"adjustment":{"id":"fact_order_commission_adjustment-order_commission_adjustment_amount"}},"alias":"affiliate_total_commission","format":"money"},{"id":"calculation","calc":"adjustment+cpc+ppb+bonus+sale","fact":True,"name":"Network Total Earnings","vars":{"cpc":{"id":"fact_cpc_earning-network_earnings"},"ppb":{"id":"fact_ppb_earning-network_commission"},"sale":{"id":"fact_order_commission-network_commission_amount"},"bonus":{"id":"fact_order_bonus-bonus_network_commission_amount"},"adjustment":{"id":"fact_order_commission_adjustment-network_commission_adjustment_amount"}},"alias":"network_total_commission","format":"money"},{"id":"calculation","calc":"sale+incentive+cpc+ppb+bonus+adjustment+nadjustment+ncpc+nppb+nbonus+nsale","fact":True,"name":"Total Cost","vars":{"cpc":{"id":"fact_cpc_earning-affiliate_earnings"},"ppb":{"id":"fact_ppb_earning-bid_amount"},"ncpc":{"id":"fact_cpc_earning-network_earnings"},"nppb":{"id":"fact_ppb_earning-network_commission"},"sale":{"id":"fact_order_commission-sale_commission_amount"},"bonus":{"id":"fact_order_bonus-bonus_commission_amount"},"nsale":{"id":"fact_order_commission-network_commission_amount"},"nbonus":{"id":"fact_order_bonus-bonus_network_commission_amount"},"incentive":{"id":"fact_order_commission-incentive_commission_amount"},"adjustment":{"id":"fact_order_commission_adjustment-order_commission_adjustment_amount"},"nadjustment":{"id":"fact_order_commission_adjustment-network_commission_adjustment_amount"}},"alias":"total_commission","format":"money"},{"id":"calculation","calc":"orders / clicks","fact":True,"name":"Conversion Rate","vars":{"clicks":{"id":"fact_hit-summary_hit_count","aggregate":[{"func":"sum"}]},"orders":{"id":"fact_order_avantlink-order_hash_key","aggregate":[{"func":"count","distinct":True}]}},"alias":"conversion_rate","format":"percent"},{"id":"calculation","calc":"sales / total","fact":True,"name":"Average Order Amount","vars":{"sales":{"id":"fact_order_avantlink-order_amount","aggregate":[{"func":"sum","distinct":True}]},"total":{"id":"fact_order_avantlink-order_hash_key","aggregate":[{"func":"count","distinct":True}]}},"alias":"avg_order_amount","format":"money"}],"report_name":"Performance Summary By Network","format":"json","filters":[{"field":"dim_date-mm_dd_yyyy","op":"relative_date","values":[],"alias":"date_picker1","allow_empty":True,"to_date":False,"count":1,"start":-1,"period":"month"}],"partitions":[],"sort":[],"totals":True,"widths":True,"counts":True,"partitionLimit":2,"offset":0,"limit":30,"partitionOffset":0}}

comparison = Comparison(sources.PickerReport(request_object=request_object),
                        sources.PickerReport(picker_url='http://localhost:3001/rpt',
                                             request_object=request_object))

comparison.run_and_barf()
print('Done')